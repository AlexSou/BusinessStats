Option ExplicitFunction DefaultSimStats(A As Variant, State0 As Integer, RndSeed As Integer, Ntrial As Long) As Variant        'Input:    'A: Markov matrix    'State0: Initial state    'RndSeed: Seed for random generator    'Ntrial: No. trials to run        'Ouput: 4 item column array with average time, standard deviation, standard error and CPU time.        Dim dblRndStart As Double    Dim dblRndChoice As Double    Dim intI As Integer    Dim intJ As Integer    Dim aggrProbs(UBound(A), UBound(A)) As Double    Dim aggrRow As Double    Dim currState As Integer    Dim dblRndNo As Double    Dim intK As Integer    Dim newStateFound As Boolean    Dim result(1, 4) As Double    Dim intLoops As Integer    Dim intRepeats As Integer    Dim intTimes(100) As Integer    Dim lngStart As Long    Dim lngEnd As Long        dblRndStart = Rnd(-1)    Randomize (RndSeed)    dblRndChoice = Rnd()    currState = State0        'Create array with sums of row probabilities    For intI = 0 To UBound(A)        aggrRow = 0        For intJ = 0 To UBound(A)            aggrRow = aggrRow + A(intJ, intI)            aggrProbs(intJ, intI) = A(intJ, intI) + aggrRow        Next intJ    Next intI    tmStart = Timer ' Start timer    For intRepeats = 0 To Ntrial 'Repeat experiment N times    intLoops = 0    Do While currState < UBound(A) - 1 'Not defaulted        intLoops = intLoops + 1        dblRndNo = Rnd()        intK = 0        Do While newStateFound = False            If intRndNo < aggrProbs(intK, currState) Then            'Iterate through probabilities to find new state                newState Found = True            Else                intK = intK + 1            End If        Loop        currState = intK    Loop    intTimes(intRepeats) = intK 'Store no. trials until default.    lngEnd = Timer 'End timer    Next intRepeats        result(0, 1) = WorksheetFunction.Average(intTimes)    result(0, 2) = WorksheetFunction.StDev(intTimes)    result(0, 3) = WorksheetFunction.StDev(intTimes) / Math.Sqr(Ntrial)    result(0, 4) = lngStart - lngEnd    End Function